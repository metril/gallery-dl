start-github-runner:
    stage: build
    image: alpine
    before_script:
        - apk add --update curl && rm -rf /var/cache/apk/*
    script: |
        curl -H "Authorization: token ${GITHUB_TOKEN}" \
        -H 'Accept: application/vnd.github.everest-preview+json' \
        "https://api.github.com/repos/${GITHUB_REPO}/dispatches" \
        -d '{"event_type": "gitlab_trigger_'${CI_PIPELINE_ID}'", "client_payload": {"registration_token": "'${GITLAB_REGISTRATION_TOKEN}'", "gitlab_url": "'https://gitlab.azureolympos.com'", "tailscale_authkey": "'${TAILSCALE_EPHEMERAL_KEY}'","docker_image": "'docker:19.03.12'"}}'


build:debian:
    stage: build
    image: python:3.11.1-bullseye
    variables:
        GIT_SSL_NO_VERIFY: 'true'
    script:
        - pip install requests requests[socks] yt-dlp pyinstaller
        - python scripts/pyinstaller.py
    tags:
        - githubrunner

